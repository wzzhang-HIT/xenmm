% 多负载调节 开题报告
% 谢虎成

第1章 研究目的和意义
==================

1.1 课题来源
----------

本课题是 973 项目 2005CB321806“虚拟计算环境聚合与协同机制研究”课
题“虚拟计算环境实验床与仿真平台”的子课题。本文主要就虚拟机资源管理中
的内存管理进行研究。

1.2 研究目的
-----------

1.3 研究意义
-----------

第2章 研究现状及分析
=================

2.1 国内研究现状及分析
--------------------

2.2 国外研究现状及分析
--------------------

Carl A. Waldspurger 研究的 VMware ESX Server 中的多种内存管理机制[@Waldspurger2002]引
导了很多研究人员对虚拟机的内存的研究工作。他提出的气球驱动机制被引入
了 Xen 虚拟机监视器;另外,VMware ESX Server 使用了基于共享的分配策略,
每个虚拟机的共享由它正在使用中的内存以及先前管理员设定的最大最小内存
值决定。VMware ESX Server 通过取样的方法决定正在使用中的内存大小,而
本文采用的 Linux 操作系统的内核对外统计接口决定正在使用中的内存量。本
文参考了他提出的基于共享的空闲内存税方法,来计算分配给每个客户操作系统的内存值。

Stephen T. Jones 等人在 Xen 虚拟机监视器上实现了 Geiger[@Jones2006] 系统,该系统通
过监视缓冲区高速缓存,精确地推断页面什么时候被插入系统高速缓存,什么
时候从高速缓存中驱逐出来。系统还实现了一组预测机制,使得虚拟机监视器
能够做出更加明智的内存分配策略。但是,当一个客户操作系统分配多余的内
存时,Geiger 无法决定从怎么回收空闲内存供其他客户操作系统使用。

与本文工作比较相似的有 Dan Magenheimer 的内存超额提交机制[@Magenheimer2008]和 Weiming
Zhao 等人实现的虚拟机的动态内存平衡机制[@Zhao2009]。内存超额提交机制利用了操作
系统本身的内存数据统计信息来指导内存资源的管理,但内存超额提交机制只
是从每个虚拟机角度来进行内存管理,无法从全局的角度考虑内存资源的使用
情况。内存超额提交机制也是本文自发调节机制的原型,本文工作也是对
Magenheimer 工作的延伸。
Weiming Zhao 等人实现的虚拟机动态内存平衡机制,通过修改虚拟机监视
器的内存管理代码来获得每个虚拟机对物理内存的访问信息,也即拦截虚拟机
的内存访问。然后构造基于 LRU(Least Recently Used)的内存预测器预测每
个虚拟机所需的内存,从而可以知道从哪些虚拟机中回收内存。另外,动态内
存平衡机制也采用了操作系统本身的内存统计信息,通过操作系统交换空间的
使用情况检测内存不足。
总之,多人的研究工作都是从虚拟机内核或者操作系统内核的角度完成对
内存的管理工作,而本文利用了现有的驱动和内核接口,从应用的角度完成了
虚拟机的内存管理工作,也是对虚拟机内存管理的一类探索。

第3章 主要研究内容
================

虚拟机资源管理包括对内存、CPU 和 I/O 设备等资源的管理。本文主要是
基于 Xen 虚拟机监视器,研究开发一种多个虚拟机之间平衡内存资源的系统。

内存超额机制
-----------

因为我们主要是直接承接Dan Magenheimer的内存超额机制的工作.
所以这里有必要先描述清楚Dan Magenheimer的内容以及我们与之的异同.

**HERE TO WORK**

为实现多虚拟机之间的内存资源平衡,需要完成对内存使用数据的收集、
分析,然后决定分配给每个虚拟机多少内存资源。因此,多虚拟机资源管理系
统主要分为两大模块:监视模块和调节模块。监视模块负责监视和收集物理机
和每个虚拟机的内存数据信息,供调节模块使用。调节模块根据监视模块收集
到的数据,选择适当的策略来平衡多个虚拟机之间的内存资源。

对于每个客户操作系统它都有一个提交的内存值,系统真实使用的内存大
小不会超过这个提交内存值。我们规定当所有客户操作系统的提交内存值之和
小于物理机空闲内存时,称为内存资源充裕状态;反之称为内存资源紧缺状态。

那么在这两种不同的状态下,我们如何实现对多个虚拟机资源进行管理?在资
源充裕状态下,本文利用了 Dan Magenheimer 提出的自发调节的方法,根据每
个客户操作系统的提交内存值来调节每个客户操作系统的内存值;在资源紧缺
的状态下,本文结合自发调节和 Carl A. Waldspurger 提出的基于共享的分配方
法,提出了基于空闲内存价格的调节方法。全局价格平衡调节法,通过利用空
闲内存税和空闲交换空间加权来计算分配给每个客户操作系统的内存的价格,
通过平衡内存的价格,计算得出应当分配给每个客户操作系统多少内存资源,
从而达到了从全局角度平衡多个虚拟机的内存资源。


我们理论设计包括:

* 公式的设计
* 理论评估

我们的目标系统基本设计为2个部分:

* 客户端: 主要负责记录需要的信息,包括内存使用量等等.定时发送给仲裁端.
* 仲裁端: 主要负责使用客户端收集到的信息.并且集中运算.并把运算结果即
  分配方案应用于各个虚拟机.

还有一些小部分包括:

* 测试样例: 方便完成测试之用
* 实验评估


第4章 研究方案
============

4.1 研究方案
-----------

4.2 进度安排
-----------

4.3 预期达到的目标
----------------

第5章 所需条件及经费
==================

第6章 预计困难和问题
==================

6.1 可能遇到的困难和问题
---------------------

6.2 解决措施
-----------

参考文献
=======

